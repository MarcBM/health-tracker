# Health Tracker Dashboard - AI System Prompt

## Project Context
You are working on a **personal health tracking dashboard** built with **FastAPI, SQLite, and Jinja2 templates**. This is a web application for tracking daily health metrics with data visualization and user authentication.

## Key Project Information

### Primary User & Use Case
- **Owner**: Marc (primary user with full edit permissions)
- **Secondary User**: Marc's wife (view-only access)
- **Purpose**: Daily health habit tracking and progress visualization
- **Data Entry**: Single daily form for all metrics (calories, steps, weight, exercise)

### Tech Stack & Architecture
- **Backend**: FastAPI with SQLAlchemy ORM
- **Database**: SQLite (suitable for personal use)
- **Frontend**: Jinja2 templates + Bootstrap 5 + Chart.js
- **Authentication**: JWT-based with role permissions
- **Deployment**: Fly.io at health.marcbm.com.au

### Core Features
1. **Authentication System**: Login/logout with user roles
2. **Main Dashboard**: Overview with charts and streak indicators
3. **Daily Data Entry**: Single form for all daily metrics
4. **Historical Views**: Detailed history pages for each metric
5. **Data Visualization**: Interactive charts using Chart.js
6. **Missing Data Alerts**: Notifications for unfilled days

### Database Models
The application uses two primary models:

**User Model**: Handles authentication and user management with role-based permissions. Distinguishes between primary users (full edit access) and secondary users (read-only access).

**DailyData Model**: Core health tracking model that stores daily metrics for each user. Each record represents one day's health data including calories, steps, weight, exercise, and optional notes. Uses proper foreign key relationships and timestamp tracking.

### File Structure
```
health_tracker/
├── app/
│   ├── main.py              # FastAPI app entry
│   ├── database.py          # DB config & models
│   ├── auth.py              # Authentication
│   ├── models.py            # SQLAlchemy models
│   ├── schemas.py           # Pydantic schemas
│   ├── crud.py              # Database operations
│   ├── routers/             # Route modules
│   └── templates/           # Jinja2 templates
├── static/                  # CSS/JS/images
├── requirements.txt
└── fly.toml
```

## Development Guidelines

### Code Style & Patterns
- **FastAPI**: Use dependency injection for database sessions and authentication
- **Database**: Use SQLAlchemy ORM with proper relationship definitions
- **Templates**: Extend base.html template with consistent navigation
- **Security**: Always validate user permissions before data modification
- **Error Handling**: Use FastAPI's HTTPException for API errors
- **Validation**: Use Pydantic schemas for request/response validation

### Key Implementation Details
1. **Authentication Flow**: 
   - JWT tokens stored in HTTP-only cookies
   - Middleware for route protection
   - Role-based access control (primary vs secondary users)

2. **Data Entry Logic**:
   - Form pre-populates with existing data for selected date
   - Upsert pattern: update if exists, create if new
   - Default to today's date, allow date selection

3. **Dashboard Design**:
   - Mobile-responsive Bootstrap layout
   - Chart.js for interactive visualizations
   - Prominent "Enter Data" button for primary users
   - Missing data indicators/alerts

4. **Data Visualization**:
   - Weight trend: Line chart over time
   - Calories: Bar chart with daily goals
   - Steps: Progress bars and trends
   - Exercise: Streak tracking with calendar heatmap

### Specific Requirements
- **Primary User Capabilities**: Create/read/update/delete all data
- **Secondary User Capabilities**: Read-only access to all data
- **Date Handling**: Always use date objects, not strings, for consistency
- **Data Validation**: Reasonable ranges for health metrics
- **Missing Data**: Clear indicators when daily data is incomplete
- **Mobile-First UX**: Prioritize mobile user experience with touch-friendly controls, quick data entry, and intuitive navigation

### Common Tasks & Approaches
1. **Adding New Routes**: Create in appropriate router module, add to main.py
2. **Database Changes**: Update models.py, create migration if needed
3. **Template Updates**: Maintain consistent base template and styling
4. **Chart Updates**: Modify charts.js for new visualizations
5. **Authentication**: Use `get_current_user` dependency for protected routes

### Deployment Considerations
- **Environment Variables**: SECRET_KEY, DATABASE_URL, admin credentials
- **Static Files**: Serve via FastAPI's StaticFiles
- **Database**: SQLite file-based, ensure proper permissions
- **SSL**: Handled by Fly.io with custom domain

### Testing Strategy
- **Unit Tests**: Core business logic and data validation
- **Integration Tests**: Authentication flow and data entry
- **Manual Testing**: UI/UX and visualization functionality

## AI Assistant Instructions

### When Working on This Project:
1. **Always consider user roles** when implementing features
2. **Prioritize mobile UX** - design mobile-first with touch-friendly controls and quick interactions
3. **Maintain responsive design** ensuring excellent experience across all device sizes
4. **Use consistent styling** with Bootstrap classes and custom CSS
4. **Validate data inputs** with appropriate ranges and types
5. **Test authentication flows** when modifying auth-related code
6. **Consider data visualization** impact when changing data models
7. **Follow FastAPI best practices** for route organization and dependencies

### Preferred Solutions:
- **Database Operations**: Use SQLAlchemy ORM, not raw SQL
- **Authentication**: JWT tokens with HTTP-only cookies
- **Frontend**: Server-side rendering with progressive enhancement
- **Styling**: Bootstrap 5 with minimal custom CSS
- **Charts**: Chart.js for consistency and performance

### Common Patterns:
```python
# Route with authentication
@router.get("/dashboard")
async def dashboard(current_user: User = Depends(get_current_user)):
    # Implementation

# Database query with relationships
def get_user_data(db: Session, user_id: int, start_date: date, end_date: date):
    return db.query(DailyData).filter(
        DailyData.user_id == user_id,
        DailyData.date.between(start_date, end_date)
    ).all()
```

### When Making Changes:
1. Consider impact on both user types (primary/secondary)
2. Test mobile UX first - ensure touch-friendly and intuitive on small screens
3. Ensure responsive design works excellently across all device sizes
4. Update relevant documentation if architecture changes
4. Test data entry and visualization flows
5. Verify authentication and authorization work correctly

Remember: This is a personal health tracking app focused on simplicity and daily use. Prioritize user experience and data accuracy over complex features. 